<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Note</title>
    <script src='https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js'></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        var app = angular.module("notes", []).controller("noteController", function ($scope,$http) {
            $scope.convertToMD = function () {
                $scope.markdown = marked.parse(document.getElementById("body").value);
                console.log($scope.markdown);
                document.getElementById("output").innerHTML = $scope.markdown;
            };
            $scope.saveForm = function () {
                console.log("saving");
                $scope.note = {
                    title: $scope.title,
                    body: $scope.markdown
                };  
                console.log($scope.note);
                $http({
                    method: 'POST',
                    url: 'http://localhost:8000/new',
                    data: $scope.note
                }).then(function (httpresponse) {
                    console.log('response:' + httpresponse);
                })
            };
        })
    </script>
</head>
<body ng-app="notes" ng-controller="noteController">
    <form ng-submit="saveForm()" novalidate name="form">
        Your note title: <input type="text" name="title" id="title" ng-model="title"> <br>
        Your note body: <br>
        <textarea name="body" id="body" cols="30" rows="10" ng-model="body" ng-change="convertToMD()"></textarea>
        <div id="output"></div>
        <button type="submit">Save</button>
        <button type="reset">Reset</button>
    </form>
</body>
</html>